version: "2.4"
services:
  changedetector:
    image: ghcr.io/dgtlmoon/changedetection.io:0.45
    container_name: changedetector
    restart: unless-stopped
    labels:
      - traefik.enable=true
      - traefik.http.services.changedetector.loadbalancer.server.port=5000
      - show.external=true
    # healthcheck:
    #   test: ["CMD", "curl", "-fs", "-S", "--max-time", "2", "http://localhost:5000"]
    #   interval: 30s
    #   timeout: 10s
    #   retries: 5
    volumes:
      - ./data:/datastore
    environment:
      - PUID=9001
      - PGID=9001
      - USE_X_SETTINGS=1
      - PLAYWRIGHT_DRIVER_URL=ws://playwright-chrome:3000/?stealth=1&--disable-web-security=true
    depends_on:
      - playwright-chrome
  playwright-chrome:
    hostname: playwright-chrome
    image: browserless/chrome:latest@sha256:86acd4560822ebe22a93080c26724b97a7c1f5c45c874c6b8737c727a6ae58d8
    restart: unless-stopped

networks:
  default:
    external: true
    name: ctr-network
