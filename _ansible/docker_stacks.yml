---
- hosts: localhost
  
  vars:
    all: {}

  tasks:
  - name: Load Docker Stacks
    include_vars:
      file: "{{ item }}"
      name: all
      hash_behaviour: merge
    when: filename is not defined
    loop: "{{ query('fileglob', 'stacks/*.yml') }}"
    tags: always
  - name: Load Single Docker Stack
    include_vars:
      file: "stacks/{{ filename }}.yml"
      name: all
    when: filename is defined
    tags: always
  - name: Create Stacks
    include_tasks: includes/stack.yml
    loop: "{{ all | dict2items }}"
    loop_control:
      loop_var: file
    tags: always