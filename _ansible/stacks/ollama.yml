ollama:
  sablier:
    group: ollama
    displayName: Open WebUI
  rootEnv:
    SEARXNG_HOSTNAME: 'searxng.{{ externalDomain }}'
  services:
  - name: ollama
    image: ollama/ollama:0.16.1@sha256:dca1224ecd799f764b21b8d74a17afdc00505ecce93e7b55530d124115b42260
    exposed:
      internal: true
      external: true
      port: 11434
    ports:
      - 11434:11434
    env:
      - OLLAMA_KEEP_ALIVE=5m
      - OLLAMA_HOST=0.0.0.0
    volumes:
      - local: code
        container: /code
      - data: ollama
        container: /root/.ollama
    addGpu: true
  - name: openwebui
    image: ghcr.io/open-webui/open-webui:main@sha256:2b9d2bec40ff30eb71216065f5244c2861d30b75b4e49c40e39973ee64218cde
    exposed:
      internal: true
      external: true
      port: 8080
    env:
      OLLAMA_BASE_URLS: http://ollama:11434 #comma separated ollama hosts
      ENV: prod
      WEBUI_AUTH_TRUSTED_EMAIL_HEADER: REMOTE-EMAIL
      WEBUI_AUTH_TRUSTED_NAME_HEADER: REMOTE-NAME
    volumes:
      - local: openwebui
        container: /app/backend/data
    healthcheck:
      url: http://localhost:8080/health
    dependsOn:
      - ollama
  - name: deepresearch
    image: localdeepresearch/local-deep-research:1.3.49@sha256:2249edb7319257880273157b0207fabd9b0fccba234ebdaa5d40091bee7ea3fe
    exposed:
      internal: true
      external: true
      port: 5000
    env:
      - OLLAMA_BASE_URL=http://ollama:11434
      # LLM Configuration
      - LDR_LLM__PROVIDER=ollama
      - LDR_LLM__MODEL=gemma3
      - LDR_LLM__TEMPERATURE=0.7
      
      # Search Configuration
      - LDR_SEARCH__TOOL=auto
      - LDR_SEARCH__ITERATIONS=2
      - LDR_SEARCH__QUESTIONS_PER_ITERATION=2

      # Searxng Configuration
      - SEARXNG_INSTANCE=http://searxng:8080
      - SEARXNG_DELAY=2.0
      
      # Web Interface Settings
      - LDR_WEB__PORT=5000
      - LDR_WEB__HOST=0.0.0.0
    volumes:
      - local: deepresearch
        container: /root/.config/local_deep_research
    dependsOn:
      - ollama
      - searxng
  - name: searxng
    image: docker.io/searxng/searxng:latest@sha256:52cdbc6697de3c263799363bf6d4788005b0e3386bfbbf4e060a9177e4493d57
    exposed:
      internal: true
      external: true
      port: 8080
    env:
      - SEARXNG_BASE_URL=https://${SEARXNG_HOSTNAME:-localhost}/
    volumes:
      - local: searxng
        container: /etc/searxng
        permissions: rw
    healthcheck:
      url: http://localhost:8080/
      tool: wget
