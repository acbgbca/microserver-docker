ollama:
  sablier:
    group: ollama
    displayName: Open WebUI
  rootEnv:
    SEARXNG_HOSTNAME: 'searxng.{{ externalDomain }}'
  services:
  - name: ollama
    image: ollama/ollama:0.12.9@sha256:889ae74bdb4aa541044574d3e5e5dedde3c682c8b7918b6792aa031e7dfc8f06
    exposed:
      internal: true
      external: true
      port: 11434
    ports:
      - 11434:11434
    env:
      - OLLAMA_KEEP_ALIVE=5m
      - OLLAMA_HOST=0.0.0.0
    volumes:
      - local: code
        container: /code
      - data: ollama
        container: /root/.ollama
    addGpu: true
  - name: openwebui
    image: ghcr.io/open-webui/open-webui:main@sha256:d6ab9bce3030f5b58e59144a7db9fe3012b39c94d27bc2979e98e6d6dc2161da
    exposed:
      internal: true
      external: true
      port: 8080
    env:
      OLLAMA_BASE_URLS: http://ollama:11434 #comma separated ollama hosts
      ENV: prod
      WEBUI_AUTH_TRUSTED_EMAIL_HEADER: REMOTE-EMAIL
      WEBUI_AUTH_TRUSTED_NAME_HEADER: REMOTE-NAME
    volumes:
      - local: openwebui
        container: /app/backend/data
    healthcheck:
      url: http://localhost:8080/health
    dependsOn:
      - ollama
  - name: deepresearch
    image: localdeepresearch/local-deep-research:1.2.14@sha256:e34bed441bbc4f0d95dedddf82993d8cd8fb3fa577873054c21c6de4e08bd255
    exposed:
      internal: true
      external: true
      port: 5000
    env:
      - OLLAMA_BASE_URL=http://ollama:11434
      # LLM Configuration
      - LDR_LLM__PROVIDER=ollama
      - LDR_LLM__MODEL=gemma3
      - LDR_LLM__TEMPERATURE=0.7
      
      # Search Configuration
      - LDR_SEARCH__TOOL=auto
      - LDR_SEARCH__ITERATIONS=2
      - LDR_SEARCH__QUESTIONS_PER_ITERATION=2

      # Searxng Configuration
      - SEARXNG_INSTANCE=http://searxng:8080
      - SEARXNG_DELAY=2.0
      
      # Web Interface Settings
      - LDR_WEB__PORT=5000
      - LDR_WEB__HOST=0.0.0.0
    volumes:
      - local: deepresearch
        container: /root/.config/local_deep_research
    dependsOn:
      - ollama
      - searxng
  - name: searxng
    image: docker.io/searxng/searxng:latest@sha256:84ecefdad968f760171a2052689ffe02ed9916e7602e164dbc87a99001ebb1c6
    exposed:
      internal: true
      external: true
      port: 8080
    env:
      - SEARXNG_BASE_URL=https://${SEARXNG_HOSTNAME:-localhost}/
    volumes:
      - local: searxng
        container: /etc/searxng
        permissions: rw
    healthcheck:
      url: http://localhost:8080/
      tool: wget
