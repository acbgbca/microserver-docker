ollama:
  sablier:
    group: ollama
    displayName: Open WebUI
  rootEnv:
    SEARXNG_HOSTNAME: 'searxng.{{ externalDomain }}'
  services:
  - name: ollama
    image: ollama/ollama:0.12.11@sha256:3d8a05e3432d50ea57594fabe971e46cc8fe963a0f9f8c40400bd56cd5388e47
    exposed:
      internal: true
      external: true
      port: 11434
    ports:
      - 11434:11434
    env:
      - OLLAMA_KEEP_ALIVE=5m
      - OLLAMA_HOST=0.0.0.0
    volumes:
      - local: code
        container: /code
      - data: ollama
        container: /root/.ollama
    addGpu: true
  - name: openwebui
    image: ghcr.io/open-webui/open-webui:main@sha256:53a4d2fc8c7a7cc620cd18e6fe416ed9940f2db87fddf837e3aa55111bec6995
    exposed:
      internal: true
      external: true
      port: 8080
    env:
      OLLAMA_BASE_URLS: http://ollama:11434 #comma separated ollama hosts
      ENV: prod
      WEBUI_AUTH_TRUSTED_EMAIL_HEADER: REMOTE-EMAIL
      WEBUI_AUTH_TRUSTED_NAME_HEADER: REMOTE-NAME
    volumes:
      - local: openwebui
        container: /app/backend/data
    healthcheck:
      url: http://localhost:8080/health
    dependsOn:
      - ollama
  - name: deepresearch
    image: localdeepresearch/local-deep-research:1.2.14@sha256:e34bed441bbc4f0d95dedddf82993d8cd8fb3fa577873054c21c6de4e08bd255
    exposed:
      internal: true
      external: true
      port: 5000
    env:
      - OLLAMA_BASE_URL=http://ollama:11434
      # LLM Configuration
      - LDR_LLM__PROVIDER=ollama
      - LDR_LLM__MODEL=gemma3
      - LDR_LLM__TEMPERATURE=0.7
      
      # Search Configuration
      - LDR_SEARCH__TOOL=auto
      - LDR_SEARCH__ITERATIONS=2
      - LDR_SEARCH__QUESTIONS_PER_ITERATION=2

      # Searxng Configuration
      - SEARXNG_INSTANCE=http://searxng:8080
      - SEARXNG_DELAY=2.0
      
      # Web Interface Settings
      - LDR_WEB__PORT=5000
      - LDR_WEB__HOST=0.0.0.0
    volumes:
      - local: deepresearch
        container: /root/.config/local_deep_research
    dependsOn:
      - ollama
      - searxng
  - name: searxng
    image: docker.io/searxng/searxng:latest@sha256:91da34403fc1d2c7ac23d1459af87870d87810b7d50b0c6a4585ab78846cb534
    exposed:
      internal: true
      external: true
      port: 8080
    env:
      - SEARXNG_BASE_URL=https://${SEARXNG_HOSTNAME:-localhost}/
    volumes:
      - local: searxng
        container: /etc/searxng
        permissions: rw
    healthcheck:
      url: http://localhost:8080/
      tool: wget
