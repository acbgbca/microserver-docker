ollama:
  sablier:
    group: ollama
    displayName: Open WebUI
  rootEnv:
    SEARXNG_HOSTNAME: 'searxng.{{ externalDomain }}'
  services:
  - name: ollama
    image: ollama/ollama:0.11.7@sha256:c76340da9ed9906b01ed5462ca966b608de93a76c1fbc01123d07034a99f699b
    exposed:
      internal: true
      external: true
      port: 11434
    ports:
      - 11434:11434
    env:
      - OLLAMA_KEEP_ALIVE=5m
      - OLLAMA_HOST=0.0.0.0
    volumes:
      - local: code
        container: /code
      - data: ollama
        container: /root/.ollama
    addGpu: true
  - name: openwebui
    image: ghcr.io/open-webui/open-webui:main@sha256:06f4cae7f8873ebcee7952d9993e457c1b083c6bea67b10bc356db7ac71c28e2
    exposed:
      internal: true
      external: true
      port: 8080
    env:
      OLLAMA_BASE_URLS: http://ollama:11434 #comma separated ollama hosts
      ENV: prod
      WEBUI_AUTH_TRUSTED_EMAIL_HEADER: REMOTE-EMAIL
      WEBUI_AUTH_TRUSTED_NAME_HEADER: REMOTE-NAME
    volumes:
      - local: openwebui
        container: /app/backend/data
    healthcheck:
      url: http://localhost:8080/health
    dependsOn:
      - ollama
  - name: deepresearch
    image: localdeepresearch/local-deep-research:1.0.0@sha256:a0af2515cb4766576c9ac92fb0772c54e7b3e8e23386344f2af5b402d435b0d5
    exposed:
      internal: true
      external: true
      port: 5000
    env:
      - OLLAMA_BASE_URL=http://ollama:11434
      # LLM Configuration
      - LDR_LLM__PROVIDER=ollama
      - LDR_LLM__MODEL=gemma3
      - LDR_LLM__TEMPERATURE=0.7
      
      # Search Configuration
      - LDR_SEARCH__TOOL=auto
      - LDR_SEARCH__ITERATIONS=2
      - LDR_SEARCH__QUESTIONS_PER_ITERATION=2

      # Searxng Configuration
      - SEARXNG_INSTANCE=http://searxng:8080
      - SEARXNG_DELAY=2.0
      
      # Web Interface Settings
      - LDR_WEB__PORT=5000
      - LDR_WEB__HOST=0.0.0.0
    volumes:
      - local: deepresearch
        container: /root/.config/local_deep_research
    dependsOn:
      - ollama
      - searxng
  - name: searxng
    image: docker.io/searxng/searxng:latest@sha256:cf4ae7bdd6f2c9211faec7bf39992f1a2bf0753f145589a95aaa87182bfbc6ca
    exposed:
      internal: true
      external: true
      port: 8080
    env:
      - SEARXNG_BASE_URL=https://${SEARXNG_HOSTNAME:-localhost}/
    volumes:
      - local: searxng
        container: /etc/searxng
        permissions: rw
    healthcheck:
      url: http://localhost:8080/
      tool: wget
