---
version: "3.7"
services:
  azureagent:
    build: ./image_src
    container_name: azureagent
    env_file: azure.env
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    security_opt:
      - no-new-privileges:true
    restart: 'unless-stopped'
    logging:
      driver: loki
      options:
        mode: non-blocking
        loki-url: "http://localhost:3100/loki/api/v1/push"
        loki-pipeline-stages: |
          - multiline:
              firstline: '^\d{4}-'
              max_wait_time: 3s
networks:
  default:
    external: true
    name: ctr-network